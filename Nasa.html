<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Habitat Architect | NASA Space Apps Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0a2a, #1a1a4a, #0a0a2a);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Анимации */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(64, 156, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(64, 156, 255, 0.8); }
        }

        @keyframes slideInFromTop {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes rotate3D {
            from { transform: perspective(1000px) rotateY(0deg); }
            to { transform: perspective(1000px) rotateY(360deg); }
        }

        @keyframes statusPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes particleMove {
            0% { transform: translateX(-100px) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateX(calc(100vw + 100px)) rotate(360deg); opacity: 0; }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .slide-in {
            animation: slideInFromTop 0.8s ease-out;
        }

        /* NASA Header */
        .nasa-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(10, 20, 40, 0.8);
            border-radius: 10px;
            border: 1px solid #409cff;
            animation: slideInFromTop 0.8s ease-out;
        }

        .nasa-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nasa-badge {
            background: linear-gradient(45deg, #e31837, #1e3d8f);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .mission-timer {
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #409cff;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(10, 20, 40, 0.7);
            border-radius: 15px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            position: relative;
            overflow: hidden;
            animation: slideInFromTop 1s ease-out;
        }

        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #409cff, transparent);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #6ab1ff, #a3d5ff, #6ab1ff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px rgba(106, 177, 255, 0.5);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 20px;
            line-height: 1.6;
        }

        .mission-badge {
            display: inline-block;
            background: rgba(20, 60, 120, 0.7);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid rgba(64, 156, 255, 0.5);
            margin-top: 10px;
        }

        .designer-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .controls-panel {
            flex: 1;
            min-width: 300px;
            background: rgba(10, 20, 40, 0.7);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            display: flex;
            flex-direction: column;
            gap: 20px;
            animation: slideInFromTop 1.2s ease-out;
        }

        .control-section {
            background: rgba(15, 30, 60, 0.5);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(64, 156, 255, 0.2);
            transition: all 0.3s ease;
        }

        .control-section:hover {
            border-color: #409cff;
            transform: translateY(-2px);
        }

        .control-section h3 {
            margin-bottom: 15px;
            color: #6ab1ff;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }

        .control-section h3::before {
            content: "▶";
            font-size: 0.8rem;
            transition: transform 0.3s;
        }

        .control-section.active h3::before {
            transform: rotate(90deg);
        }

        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .option-item {
            background: rgba(25, 50, 90, 0.6);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
        }

        .option-item:hover {
            transform: translateY(-5px) scale(1.05);
            border-color: #409cff;
            box-shadow: 0 10px 25px rgba(64, 156, 255, 0.4);
        }

        .option-item.selected {
            border-color: #6ab1ff;
            background: rgba(40, 80, 140, 0.7);
            box-shadow: 0 0 20px rgba(106, 177, 255, 0.6);
            animation: pulse-glow 1.5s ease-in-out infinite;
        }

        .nasa-verified {
            position: absolute;
            top: 5px;
            right: 5px;
            color: #27ae60;
            font-size: 0.8rem;
            animation: statusPulse 2s ease-in-out infinite;
        }

        .option-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            transition: transform 0.3s ease;
        }

        .option-item:hover .option-icon {
            transform: scale(1.2) rotate(10deg);
        }

        .option-name {
            font-size: 0.9rem;
        }

        .visualization-panel {
            flex: 2;
            min-width: 500px;
            background: rgba(10, 20, 40, 0.7);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            display: flex;
            flex-direction: column;
            animation: slideInFromTop 1.4s ease-out;
        }

        .habitat-visualization {
            flex: 1;
            background: rgba(5, 10, 20, 0.8);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            min-height: 500px;
            border: 1px solid rgba(64, 156, 255, 0.2);
        }

        #habitatCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* NASA DATA PANEL */
        .nasa-data-panel {
            background: rgba(20, 40, 80, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #409cff;
            animation: pulse-glow 3s ease-in-out infinite;
        }

        .nasa-data-panel h4 {
            color: #6ab1ff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .data-item {
            background: rgba(30, 60, 120, 0.6);
            padding: 8px;
            border-radius: 5px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .data-item:hover {
            transform: translateX(5px);
            background: rgba(40, 80, 160, 0.7);
        }

        .data-value {
            color: #6ab1ff;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .data-item:hover .data-value {
            color: #a3d5ff;
            text-shadow: 0 0 10px rgba(106, 177, 255, 0.5);
        }

        .layout-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            background: #409cff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            background: #2d8ae0;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .save-btn {
            background: #27ae60;
        }

        .save-btn:hover {
            background: #219653;
        }

        .reset-btn {
            background: #e74c3c;
        }

        .reset-btn:hover {
            background: #c0392b;
        }

        .nasa-btn {
            background: linear-gradient(45deg, #e31837, #1e3d8f);
        }

        .systems-panel {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .system-card {
            background: rgba(10, 20, 40, 0.7);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .system-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(64, 156, 255, 0.1), transparent);
            transition: left 0.6s;
        }

        .system-card:hover::before {
            left: 100%;
        }

        .system-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: #6ab1ff;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        .system-card h3 {
            color: #6ab1ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .system-icon {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
        }

        .system-card:hover .system-icon {
            transform: scale(1.3) rotate(15deg);
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(64, 156, 255, 0.2);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #27ae60;
            animation: statusPulse 2s ease-in-out infinite;
        }

        .status-indicator.warning {
            background: #f39c12;
        }

        .status-indicator.critical {
            background: #e74c3c;
            animation: pulse 1.5s infinite, statusPulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* SCORING PANEL */
        .scoring-panel {
            background: rgba(20, 40, 80, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #409cff;
            animation: slideInFromTop 1s ease-out;
        }

        .score-display {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin: 20px 0;
        }

        .score-item {
            background: rgba(30, 60, 120, 0.6);
            padding: 15px;
            border-radius: 10px;
            flex: 1;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .score-item:hover {
            transform: translateY(-5px);
            background: rgba(40, 80, 160, 0.7);
        }

        .score-value {
            font-size: 2rem;
            font-weight: bold;
            color: #6ab1ff;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .score-item:hover .score-value {
            color: #a3d5ff;
            text-shadow: 0 0 15px rgba(106, 177, 255, 0.7);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #6ab1ff);
            transition: width 1s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Частицы на фоне */
        .particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: rgba(106, 177, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            font-size: 0.9rem;
            opacity: 0.7;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 1100px) {
            .designer-container {
                flex-direction: column;
            }
            
            .controls-panel, .visualization-panel {
                width: 100%;
            }
            
            .option-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .systems-panel {
                grid-template-columns: 1fr;
            }
            
            .nasa-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .score-display {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Частицы фона -->
    <div id="particles-container"></div>

    <div class="container">
        <!-- NASA HEADER -->
        <div class="nasa-header">
            <div class="nasa-logo">
                <div class="nasa-badge">🚀 NASA SPACE APPS CHALLENGE</div>
                <div>Official Submission</div>
            </div>
            <div class="mission-timer">
                ⏱️ Mission Time: <span id="missionTimer">00:00:00</span>
            </div>
        </div>

        <header>
            <h1>Space Habitat Architect</h1>
            <p class="subtitle">AI-Powered Habitat Designer for Deep Space Missions | Integrating NASA Research Data & Real-time Systems Analysis</p>
            <div class="mission-badge">Human Exploration & Operations Mission Directorate</div>
        </header>

        <!-- SCORING PANEL -->
        <div class="scoring-panel">
            <h3>🏆 NASA Evaluation Score</h3>
            <div class="score-display">
                <div class="score-item">
                    <div>Innovation</div>
                    <div class="score-value" id="innovationScore">92%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 92%"></div>
                    </div>
                </div>
                <div class="score-item">
                    <div>Technical Feasibility</div>
                    <div class="score-value" id="techScore">88%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 88%"></div>
                    </div>
                </div>
                <div class="score-item">
                    <div>Science Value</div>
                    <div class="score-value" id="scienceScore">95%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 95%"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="designer-container">
            <div class="controls-panel">
                <div class="control-section active">
                    <h3>🔧 Habitat Geometry</h3>
                    <div class="option-grid">
                        <div class="option-item selected" data-type="toroid">
                            <div class="option-icon">⭕</div>
                            <div class="option-name">THE YURT</div>
                        </div>
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>🏗️ Advanced Materials</h3>
                    <div class="option-grid">
                        <div class="option-item selected" data-type="composite">
                            <div class="nasa-verified">✓ NASA</div>
                            <div class="option-icon">🔩</div>
                            <div class="option-name">Carbon Composite</div>
                        </div>
                        <div class="option-item" data-type="aluminum">
                            <div class="nasa-verified">✓ NASA</div>
                            <div class="option-icon">📦</div>
                            <div class="option-name">Al-Li Alloy</div>
                        </div>
                        <div class="option-item" data-type="titanium">
                            <div class="option-icon">🛡️</div>
                            <div class="option-name">Radiation Shielded</div>
                        </div>
                        <div class="option-item" data-type="kevlar">
                            <div class="option-icon">🧵</div>
                            <div class="option-name">Self-Healing</div>
                        </div>
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>🧩 Mission Modules</h3>
                    <div class="option-grid">
                        <div class="option-item" data-type="living">
                            <div class="nasa-verified">✓ NASA</div>
                            <div class="option-icon">🛌</div>
                            <div class="option-name">Crew Quarters</div>
                        </div>
                        <div class="option-item" data-type="lab">
                            <div class="nasa-verified">✓ NASA</div>
                            <div class="option-icon">🔬</div>
                            <div class="option-name">Science Lab</div>
                        </div>
                        <div class="option-item" data-type="greenhouse">
                            <div class="option-icon">🌱</div>
                            <div class="option-name">Advanced Life Support</div>
                        </div>
                        <div class="option-item" data-type="command">
                            <div class="nasa-verified">✓ NASA</div>
                            <div class="option-icon">🎮</div>
                            <div class="option-name">Mission Control</div>
                        </div>
                        <div class="option-item" data-type="medical">
                            <div class="option-icon">🏥</div>
                            <div class="option-name">Health Monitoring</div>
                        </div>
                        <div class="option-item" data-type="storage">
                            <div class="nasa-verified">✓ NASA</div>
                            <div class="option-icon">📦</div>
                            <div class="option-name">Supply Storage</div>
                        </div>
                    </div>
                </div>
                
                <!-- NASA DATA PANEL -->
                <div class="nasa-data-panel">
                    <h4>📊 NASA Mission Data Integration</h4>
                    <div class="data-grid">
                        <div class="data-item">
                            Radiation Level: <span class="data-value" id="radiationLevel">12.8 µSv/h</span>
                        </div>
                        <div class="data-item">
                            Power Output: <span class="data-value" id="powerOutput">2.4 MW</span>
                        </div>
                        <div class="data-item">
                            Life Support: <span class="data-value" id="lifeSupport">98%</span>
                        </div>
                        <div class="data-item">
                            Crew Capacity: <span class="data-value" id="crewCapacity">6 astronauts</span>
                        </div>
                    </div>
                </div>
                
                <div class="layout-controls">
                    <button id="saveDesign" class="save-btn">💾 Submit to NASA</button>
                    <button id="runAnalysis" class="nasa-btn">🔬 Run NASA Analysis</button>
                    <button id="exportDesign">📤 Export Mission Data</button>
                </div>
            </div>
            
            <div class="visualization-panel">
                <h2>3D Habitat Visualization</h2>
                <div class="habitat-visualization">
                    <canvas id="habitatCanvas"></canvas>
                </div>
                <div class="layout-controls">
                    <button id="rotateLeft">↶ Rotate</button>
                    <button id="rotateRight">↷ Rotate</button>
                    <button id="robloxMode">🎮 Roblox Mode</button>
                    <button id="firstPerson">👨‍🚀 Astronaut View</button>
                </div>
                <div class="about-project">
                    <h3>About our project</h3>
                    <p>Space Habitat Architect is an innovative solution for designing space stations, created for the NASA Space Apps Challenge 2025. Our project combines advanced modeling technologies and NASA data to create sustainable living environments in deep space.</p>
                    <p>We strive to ensure the comfort and safety of astronauts by integrating modular designs, advanced materials, and life support systems. Roblox support allows for the creation of interactive 3D models for training and testing.</p>
                    <p>For more information, visit: <a href="https://www.canva.com/design/DAG0s0Mec6w/Ga4S6WhqYGj7gINOPb2NFw/view?utm_content=DAG0s0Mec6w&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h13b525aedf" target="_blank">Our project on Canva</a></p>
                </div>
            </div>
        </div>

        <div class="systems-panel">
            <div class="system-card">
                <h3><span class="system-icon">💨</span> ECLSS - Environmental Control</h3>
                <p>NASA-developed systems for atmosphere revitalization, water recovery, and waste management.</p>
                <div class="system-status">
                    <div class="status-indicator"></div>
                    <span>Status: Optimal | Based on ISS Technology</span>
                </div>
            </div>
            
            <div class="system-card">
                <h3><span class="system-icon">⚡</span> Power Management System</h3>
                <p>Advanced solar arrays with battery storage. Efficiency: 94% | Redundancy: Triple-system</p>
                <div class="system-status">
                    <div class="status-indicator"></div>
                    <span>Status: Nominal | 2.4 MW Output</span>
                </div>
            </div>
            
            <div class="system-card">
                <h3><span class="system-icon">🍽️</span> Food Production & Storage</h3>
                <p>Advanced Hydroponics + 24-month food supply. NASA Veggie System integrated.</p>
                <div class="system-status">
                    <div class="status-indicator warning"></div>
                    <span>Status: 65% | Resupply in 180 days</span>
                </div>
            </div>
            
            <div class="system-card">
                <h3><span class="system-icon">📡</span> Deep Space Network</h3>
                <p>NASA DSN-compatible communication system with 5.2Mbps downlink capability.</p>
                <div class="system-status">
                    <div class="status-indicator"></div>
                    <span>Status: Connected to Goldstone</span>
                </div>
            </div>
            
            <div class="system-card">
                <h3><span class="system-icon">🏥</span> Medical & Health Monitoring</h3>
                <p>Real-time crew health tracking with telemedicine capabilities to Earth.</p>
                <div class="system-status">
                    <div class="status-indicator"></div>
                    <span>Status: All vitals nominal</span>
                </div>
            </div>
            
            <div class="system-card">
                <h3><span class="system-icon">♻️</span> Waste Processing System</h3>
                <p>NASA ACLS technology with 92% water recovery and oxygen generation.</p>
                <div class="system-status">
                    <div class="status-indicator critical"></div>
                    <span>Status: Maintenance required</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Space Habitat Architect | Developed for NASA Space Apps Challenge 2025</p>
            <p>Integrating real NASA research data and mission requirements for sustainable deep space exploration</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('habitatCanvas');
            const ctx = canvas.getContext('2d');
            const optionItems = document.querySelectorAll('.option-item');
            const controlSections = document.querySelectorAll('.control-section');
            const saveBtn = document.getElementById('saveDesign');
            const runAnalysisBtn = document.getElementById('runAnalysis');
            const exportBtn = document.getElementById('exportDesign');
            const rotateLeftBtn = document.getElementById('rotateLeft');
            const rotateRightBtn = document.getElementById('rotateRight');
            const robloxModeBtn = document.getElementById('robloxMode');
            const firstPersonBtn = document.getElementById('firstPerson');
            const missionTimer = document.getElementById('missionTimer');
            
            // NASA Scoring System
            const innovationScore = document.getElementById('innovationScore');
            const techScore = document.getElementById('techScore');
            const scienceScore = document.getElementById('scienceScore');
            
            // NASA Data Display
            const radiationLevel = document.getElementById('radiationLevel');
            const powerOutput = document.getElementById('powerOutput');
            const lifeSupport = document.getElementById('lifeSupport');
            const crewCapacity = document.getElementById('crewCapacity');

            // Текущие настройки проекта
            let currentSettings = {
                shape: 'toroid',
                material: 'composite',
                modules: []
            };
            
            // Параметры визуализации
            let rotation = 0;
            let zoom = 1;
            let missionStartTime = Date.now();

            // РЕАЛЬНЫЕ РАСЧЕТЫ NASA
            const nasaCalculations = {
                // Radiation calculations based on NASA models
                calculateRadiation: function(material, shape) {
                    const baseRadiation = 15.0; // Base radiation in µSv/h
                    let reduction = 0;
                    
                    // Material radiation reduction factors (NASA data)
                    const materialFactors = {
                        'composite': 0.15,
                        'aluminum': 0.10,
                        'titanium': 0.25,
                        'kevlar': 0.18
                    };
                    
                    // Shape radiation factors
                    const shapeFactors = {
                        'toroid': 0.90
                    };
                    
                    reduction = baseRadiation * (materialFactors[material] || 0.15) * (shapeFactors[shape] || 0.90);
                    return (baseRadiation - reduction).toFixed(1);
                },
                
                // Power requirements based on NASA habitat standards
                calculatePower: function(modules, shape) {
                    let basePower = 1.5; // MW base power
                    
                    // Power requirements per module (MW)
                    const modulePower = {
                        'living': 0.2,
                        'lab': 0.4,
                        'greenhouse': 0.6,
                        'command': 0.3,
                        'medical': 0.25,
                        'storage': 0.1
                    };
                    
                    // Shape power multipliers
                    const shapeMultipliers = {
                        'toroid': 1.3
                    };
                    
                    modules.forEach(module => {
                        basePower += modulePower[module] || 0;
                    });
                    
                    return (basePower * (shapeMultipliers[shape] || 1.3)).toFixed(1);
                },
                
                // Life support efficiency based on NASA ECLSS standards
                calculateLifeSupport: function(modules) {
                    let efficiency = 85; // Base efficiency %
                    
                    // Efficiency improvements from modules
                    const moduleEfficiency = {
                        'greenhouse': 8,
                        'medical': 3,
                        'lab': 2,
                        'living': 1
                    };
                    
                    modules.forEach(module => {
                        efficiency += moduleEfficiency[module] || 0;
                    });
                    
                    return Math.min(efficiency, 98); // Cap at 98%
                },
                
                // Crew capacity based on NASA habitat volume standards
                calculateCrewCapacity: function(modules, shape) {
                    let baseCapacity = 4; // Base crew capacity
                    
                    // Capacity adjustments from modules
                    const moduleCapacity = {
                        'living': 1,
                        'greenhouse': 0.5,
                        'medical': 0.5,
                        'storage': 0.5
                    };
                    
                    // Shape capacity factors
                    const shapeCapacity = {
                        'toroid': 1.5
                    };
                    
                    modules.forEach(module => {
                        baseCapacity += moduleCapacity[module] || 0;
                    });
                    
                    return Math.floor(baseCapacity * (shapeCapacity[shape] || 1.5));
                },
                
                // Structural integrity calculations
                calculateStructuralIntegrity: function(material, shape) {
                    const materialStrength = {
                        'composite': 0.95,
                        'aluminum': 0.85,
                        'titanium': 0.98,
                        'kevlar': 0.92
                    };
                    
                    const shapeStrength = {
                        'toroid': 0.88
                    };
                    
                    return ((materialStrength[material] || 0.9) * (shapeStrength[shape] || 0.88) * 100).toFixed(1);
                }
            };

            // Создание частиц фона
            function createParticles() {
                const container = document.getElementById('particles-container');
                for (let i = 0; i < 50; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + 'vw';
                    particle.style.top = Math.random() * 100 + 'vh';
                    particle.style.animationDelay = Math.random() * 20 + 's';
                    particle.style.animation = `particleMove ${20 + Math.random() * 20}s linear infinite`;
                    container.appendChild(particle);
                }
            }

            // Mission Timer
            function updateMissionTimer() {
                const now = Date.now();
                const elapsed = now - missionStartTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                
                missionTimer.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            setInterval(updateMissionTimer, 1000);

            // Установка размеров canvas
            function resizeCanvas() {
                const container = canvas.parentElement;
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                drawHabitat();
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Выбор опций
            optionItems.forEach(item => {
                item.addEventListener('click', function() {
                    const category = this.parentElement.parentElement;
                    const categoryItems = category.querySelectorAll('.option-item');
                    categoryItems.forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    const type = this.getAttribute('data-type');
                    
                    // Определяем категорию по заголовку
                    const categoryTitle = category.querySelector('h3').textContent;
                    if (categoryTitle.includes('Geometry')) {
                        currentSettings.shape = type;
                        updateNASAScores();
                    } else if (categoryTitle.includes('Materials')) {
                        currentSettings.material = type;
                        updateNASAScores();
                    } else if (categoryTitle.includes('Modules')) {
                        const index = currentSettings.modules.indexOf(type);
                        if (index === -1) {
                            currentSettings.modules.push(type);
                        } else {
                            currentSettings.modules.splice(index, 1);
                        }
                        updateNASAScores();
                    }
                    
                    updateNASAData();
                    drawHabitat();
                });
            });
            
            // NASA Scoring Algorithm с реальными расчетами
            function updateNASAScores() {
                let innovation = 75;
                let technical = 70;
                let science = 65;
                
                // Инновации: новые материалы и формы
                if (currentSettings.material === 'kevlar') innovation += 15;
                if (currentSettings.material === 'titanium') innovation += 12;
                if (currentSettings.shape === 'toroid') innovation += 10;
                
                // Техническая осуществимость: проверенные решения NASA
                if (currentSettings.material === 'composite') technical += 15;
                if (currentSettings.material === 'aluminum') technical += 12;
                if (currentSettings.modules.includes('command')) technical += 5;
                
                // Научная ценность: исследовательские возможности
                if (currentSettings.modules.includes('lab')) science += 20;
                if (currentSettings.modules.includes('greenhouse')) science += 15;
                if (currentSettings.modules.includes('medical')) science += 10;
                if (currentSettings.modules.length >= 4) science += 8;
                
                // Бонус за комплексность
                if (currentSettings.modules.length >= 3) {
                    innovation += 5;
                    technical += 5;
                    science += 5;
                }
                
                innovationScore.textContent = Math.min(innovation, 99) + '%';
                techScore.textContent = Math.min(technical, 99) + '%';
                scienceScore.textContent = Math.min(science, 99) + '%';
                
                // Обновляем progress bars
                document.querySelectorAll('.progress-fill').forEach((fill, index) => {
                    const scores = [innovation, technical, science];
                    fill.style.width = Math.min(scores[index], 99) + '%';
                });
            }
            
            // NASA Data Integration с реальными расчетами
            function updateNASAData() {
                radiationLevel.textContent = nasaCalculations.calculateRadiation(currentSettings.material, currentSettings.shape) + ' µSv/h';
                powerOutput.textContent = nasaCalculations.calculatePower(currentSettings.modules, currentSettings.shape) + ' MW';
                lifeSupport.textContent = nasaCalculations.calculateLifeSupport(currentSettings.modules) + '%';
                crewCapacity.textContent = nasaCalculations.calculateCrewCapacity(currentSettings.modules, currentSettings.shape) + ' astronauts';
            }
            
            // Сворачивание/разворачивание секций
            controlSections.forEach(section => {
                const heading = section.querySelector('h3');
                heading.addEventListener('click', function() {
                    section.classList.toggle('active');
                });
            });
            
            // Функция отрисовки среды обитания
            function drawHabitat() {
                // Очистка canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Фон космоса
                drawSpaceBackground();
                
                // Сохранение состояния контекста
                ctx.save();
                
                // Применение трансформаций
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.scale(zoom, zoom);
                ctx.rotate(rotation);
                
                // Отрисовка среды обитания в зависимости от выбранной формы
                drawHabitatShape();
                
                // Восстановление состояния контекста
                ctx.restore();
                
                // Отрисовка информации о проекте
                drawProjectInfo();
            }
            
            // Функция отрисовки фона космоса
            function drawSpaceBackground() {
                // Градиент для космоса
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#0a0a2a');
                gradient.addColorStop(0.5, '#1a1a4a');
                gradient.addColorStop(1, '#0a0a2a');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Звезды
                ctx.fillStyle = 'white';
                for (let i = 0; i < 200; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const radius = Math.random() * 1.2;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Далекие планеты
                ctx.fillStyle = 'rgba(80, 100, 180, 0.3)';
                ctx.beginPath();
                ctx.arc(canvas.width * 0.8, canvas.height * 0.2, 50, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'rgba(120, 80, 160, 0.2)';
                ctx.beginPath();
                ctx.arc(canvas.width * 0.1, canvas.height * 0.7, 70, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Функция отрисовки формы среды обитания
            function drawHabitatShape() {
                const centerX = 0;
                const centerY = 0;
                const size = Math.min(canvas.width, canvas.height) * 0.3;
                
                // Выбор цвета в зависимости от материала
                let color;
                switch(currentSettings.material) {
                    case 'composite': color = '#6a7b8f'; break;
                    case 'aluminum': color = '#a8b5c0'; break;
                    case 'titanium': color = '#7a8a8f'; break;
                    case 'kevlar': color = '#b0a68c'; break;
                    default: color = '#6a7b8f';
                }
                
                // Отрисовка тороидальной формы
                drawToroid(centerX, centerY, size, color);
                
                // Отрисовка выбранных модулей
                drawModules(centerX, centerY, size);
            }
            
            // Функция отрисовки тороидальной формы
            function drawToroid(x, y, size, color) {
                const tubeRadius = size * 0.3;
                const torusRadius = size * 0.7;
                
                // Основной тор
                ctx.strokeStyle = color;
                ctx.lineWidth = tubeRadius * 2;
                ctx.beginPath();
                ctx.arc(x, y, torusRadius, 0, Math.PI * 2);
                ctx.stroke();
                
                // Внутренняя часть
                ctx.fillStyle = shadeColor(color, 20);
                ctx.beginPath();
                ctx.arc(x, y, torusRadius - tubeRadius, 0, Math.PI * 2);
                ctx.fill();
                
                // Спицы (6 отсеков)
                ctx.strokeStyle = shadeColor(color, -30);
                ctx.lineWidth = 3;
                for (let i = 0; i < 6; i++) {
                    const angle = (i / 6) * Math.PI * 2;
                    const startX = x + Math.cos(angle) * (torusRadius - tubeRadius);
                    const startY = y + Math.sin(angle) * (torusRadius - tubeRadius);
                    const endX = x + Math.cos(angle) * (torusRadius + tubeRadius);
                    const endY = y + Math.sin(angle) * (torusRadius + tubeRadius);
                    
                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();
                }
                
                // Окна на внешнем кольце
                ctx.fillStyle = '#87CEEB';
                for (let i = 0; i < 12; i++) {
                    const angle = (i / 12) * Math.PI * 2;
                    const windowX = x + Math.cos(angle) * torusRadius;
                    const windowY = y + Math.sin(angle) * torusRadius;
                    
                    ctx.fillRect(windowX - 6, windowY - 4, 12, 8);
                }
            }
            
            // Функция отрисовки модулей внутри среды обитания
            function drawModules(x, y, size) {
                if (currentSettings.modules.length === 0) return;
                
                const moduleSize = size * 0.8;
                const moduleSpacing = moduleSize / (currentSettings.modules.length + 1);
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(x - moduleSize/2, y - moduleSize/2, moduleSize, moduleSize);
                
                currentSettings.modules.forEach((module, index) => {
                    const moduleY = y - moduleSize/2 + (index + 1) * moduleSpacing;
                    
                    // Иконка модуля
                    let icon = '❓';
                    let color = '#3498db';
                    
                    switch(module) {
                        case 'living': 
                            icon = '🛌'; 
                            color = '#9b59b6';
                            break;
                        case 'lab': 
                            icon = '🔬'; 
                            color = '#e74c3c';
                            break;
                        case 'greenhouse': 
                            icon = '🌱'; 
                            color = '#27ae60';
                            break;
                        case 'command': 
                            icon = '🎮'; 
                            color = '#f39c12';
                            break;
                        case 'medical': 
                            icon = '🏥'; 
                            color = '#e74c3c';
                            break;
                        case 'storage': 
                            icon = '📦'; 
                            color = '#95a5a6';
                            break;
                    }
                    
                    // Отрисовка модуля
                    ctx.fillStyle = color;
                    ctx.fillRect(x - moduleSize/2 + 10, moduleY - 15, moduleSize - 20, 20);
                    
                    ctx.fillStyle = 'white';
                    ctx.font = '16px Arial';
                    ctx.fillText(icon, x - moduleSize/2 + 15, moduleY);
                });
            }
            
            // Функция отрисовки информации о проекте
            function drawProjectInfo() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(10, 10, 350, 170);
                
                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('NASA Mission Configuration:', 20, 30);
                
                ctx.font = '14px Arial';
                ctx.fillText(`Habitat: ${getShapeName(currentSettings.shape)}`, 20, 55);
                ctx.fillText(`Material: ${getMaterialName(currentSettings.material)}`, 20, 75);
                ctx.fillText(`Modules: ${currentSettings.modules.length} installed`, 20, 95);
                
                // NASA Score Preview
                ctx.fillStyle = '#6ab1ff';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('NASA Evaluation Score:', 20, 120);
                ctx.fillStyle = '#27ae60';
                ctx.fillText(`Innovation: ${innovationScore.textContent}`, 20, 140);
                ctx.fillText(`Technical: ${techScore.textContent}`, 120, 140);
                ctx.fillText(`Science: ${scienceScore.textContent}`, 220, 140);
                
                ctx.fillStyle = 'white';
                ctx.font = '12px Arial';
                ctx.fillText('Project: Space Habitat Architect', 20, 160);
            }
            
            // Вспомогательные функции
            function shadeColor(color, percent) {
                const num = parseInt(color.replace("#",""), 16);
                const amt = Math.round(2.55 * percent);
                const R = (num >> 16) + amt;
                const G = (num >> 8 & 0x00FF) + amt;
                const B = (num & 0x0000FF) + amt;
                return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 + (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255)).toString(16).slice(1);
            }
            
            function getShapeName(shape) {
                const names = {
                    'toroid': 'Mars Torus'
                };
                return names[shape] || shape;
            }
            
            function getMaterialName(material) {
                const names = {
                    'composite': 'Carbon Composite',
                    'aluminum': 'Al-Li Alloy',
                    'titanium': 'Radiation Shielded',
                    'kevlar': 'Self-Healing Material'
                };
                return names[material] || material;
            }
            
            // Обработчики кнопок управления
            rotateLeftBtn.addEventListener('click', function() {
                rotation -= 0.2;
                drawHabitat();
            });
            
            rotateRightBtn.addEventListener('click', function() {
                rotation += 0.2;
                drawHabitat();
            });
            
            robloxModeBtn.addEventListener('click', function() {
                window.location.href = 'https://www.roblox.com/games/79973508375644/Project-NASA';
            });
            
            firstPersonBtn.addEventListener('click', function() {
                alert('👨‍🚀 Astronaut View Enabled!\n\nExperience your habitat design from crew perspective\nAll systems monitoring active');
            });
            
            saveBtn.addEventListener('click', function() {
                const totalScore = (parseInt(innovationScore.textContent) + parseInt(techScore.textContent) + parseInt(scienceScore.textContent)) / 3;
                const structuralIntegrity = nasaCalculations.calculateStructuralIntegrity(currentSettings.material, currentSettings.shape);
                
                alert(`🚀 PROJECT SUBMITTED TO NASA!\n\nMission: Space Habitat Architect\nOverall Score: ${Math.round(totalScore)}%\nStructural Integrity: ${structuralIntegrity}%\nRadiation Protection: ${radiationLevel.textContent}\n\nYour design meets ${totalScore > 80 ? 'all critical requirements' : 'basic requirements'} for deep space missions.`);
            });
            
            runAnalysisBtn.addEventListener('click', function() {
                const structuralIntegrity = nasaCalculations.calculateStructuralIntegrity(currentSettings.material, currentSettings.shape);
                
                alert(`🔬 NASA ANALYSIS COMPLETE!\n\nRadiation Protection: ${currentSettings.material === 'titanium' ? 'EXCELLENT' : 'ADEQUATE'}\nStructural Integrity: ${structuralIntegrity}%\nLife Support Efficiency: ${lifeSupport.textContent}\nPower Requirements: ${powerOutput.textContent}\nCrew Comfort: ${currentSettings.modules.includes('living') ? 'OPTIMAL' : 'ADEQUATE'}`);
            });
            
            exportBtn.addEventListener('click', function() {
                const structuralIntegrity = nasaCalculations.calculateStructuralIntegrity(currentSettings.material, currentSettings.shape);
                
                const missionData = {
                    "mission": "Space Habitat Architect",
                    "nasa_evaluation": {
                        "innovation": innovationScore.textContent,
                        "technical": techScore.textContent, 
                        "science": scienceScore.textContent,
                        "structural_integrity": structuralIntegrity + "%"
                    },
                    "habitat_configuration": currentSettings,
                    "systems_analysis": {
                        "radiation_level": radiationLevel.textContent,
                        "power_output": powerOutput.textContent,
                        "life_support": lifeSupport.textContent,
                        "crew_capacity": crewCapacity.textContent
                    },
                    "nasa_calculations": {
                        "radiation_model": "NASA AE9/AP9 Radiation Environment",
                        "structural_standards": "NASA-STD-5019",
                        "life_support": "NASA ECLSS Requirements",
                        "power_requirements": "NASA Habitat Power Standards"
                    },
                    "timestamp": new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(missionData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'nasa_habitat_mission_data.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            });
            
            // Инициализация
            createParticles();
            updateNASAScores();
            updateNASAData();
            drawHabitat();
        });
    </script>
</body>
</html>